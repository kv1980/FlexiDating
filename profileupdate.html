<!DOCTYPE html>

<html style="height: 950px; width: 1520px;">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/flexidating.css" rel="stylesheet">
    <link href="css/profileVerandering.css" rel="stylesheet">
    <title>FlexiDating - Profiel</title>
</head>
<body>
    <section class="Header">
        <div class="Rij">
            <div class="Kol8">
		<img src="img/Flexi.png" class="banner" alt="Flexi logo">
            </div>
            <div class="Kol4">
                <p class="HeaderNickName" id="weergaveNaam">Welkom</p>
                <a class="HeaderLinks" href="core.html">Annuleren</a>
            </div>
        </div>
    </section>
    <section>
        <div class="ProfielTitel">
            <h2>UW PROFIEL</h2>
            <p>FlexiDating: Wijzig hier uw gegevens.</p>
            <em>
                * = Verplicht veld
            </em>
        </div>
        <form class="Profiel">
            <div class="Rij">
                <div class="Kol6" style="margin-left:360px">
                    <table>
                        <tr>
                            <th><label for="email">Email*:</label></th>
                            <td><input type="email" id="email" name="email" placeholder="uw emailadres" class="fieldRequired" required></td>
                        </tr>
                        <tr>
                            <th><label for ="wachtwoord">Wachtwoord*:</label></th>
                            <td><input type="password" id="wachtwoord" name="wachtwoord" class="fieldRequired" placeholder="uw wachtwoord" required></td>
                        </tr>
                        <tr>
                            <th><label for ="familienaam">Familienaam*:</label></th>
                            <td><input type ="text" id="familienaam" name="familienaam" class="fieldRequired" required placeholder="uw familienaam"></td>
                        </tr>
                        <tr>
                            <th><label for = "voornaam">Voornaam*:</label></th>
                            <td><input type ="text" id="voornaam" name="voornaam" class="fieldRequired" required placeholder="uw voornaam"></td>
                        </tr>
                        <tr>
                            <th><label for = "geboortedatum">Geboortedatum*:</label></th>
                            <td><input type ="date" id="geboortedatum" name=geboortedatum class="fieldRequired" required></td>
                        </tr>
                        <tr>
                            <th><label for="foto">Foto:</label></th>
                            <td><input type="text" id="foto" name="foto" placeholder="fotonaam"></td>
                        </tr>
                        <tr>
                            <th><label for ="nickname">Nickname*:</label></th>
                            <td><input type="text" id="nickname" name="nickname" class="fieldRequired" placeholder="uw nickname" required></td>
                        </tr>
                    </table>
                </div>
                <div class="Kol6">
                    <table>
                        <tr>
                            <th><label for ="haarkleur">Haarkleur:</label></th>
                            <td><select name="haarkleur" id="haarkleur"></select></td>
                        </tr>
                        <tr>
                            <th><label for ="oogkleur">Oogkleur:</label></th>
                            <td><select name="oogkleur" id="oogkleur"></select></td>
                        </tr>
                        <tr>
                            <th><label for ="gewicht">Gewicht:</label></th>
                            <td><input type="number" id="gewicht" name="gewicht"> kg</td>
                        </tr>
                        <tr>
                            <th><label for ="grootte">Grootte:</label></th>
                            <td><input type="number" id="grootte" name="grootte"> cm</td>
                        </tr>
                        <tr>
                            <th><label for ="beroep">Beroep:</label></th>
                            <td><input type="text" id="beroep" name="beroep" placeholder="uw beroep"></td>
                        </tr>
                        <tr>
                            <th><label for ="sexe">Geslacht:*</label></th>
                            <td><input type = "radio" id="sexem" name="sexe" value="m">Man
                                <input type = "radio" id="sexev" name="sexe" value="v">Vrouw</td>
                        </tr>
                        <tr>
                            <th><label for ="seksvoorkeur">Geaardheid:*</label></th>
                            <td><input type = "radio" name="seksvoorkeur" value="homo">Homo
                                <input type = "radio" name="seksvoorkeur" value="hetero">Hetero
                                <input type = "radio" name="seksvoorkeur" value="bi">Bi</td>
                        </tr>
                    </table>
                </div>
            </div>
        </form>
        <div class="Rij">
                <div class="knoppen">
                    <input type="button" id="bewaren" name="bewaren" value="Gegevens Opslaan">
                </div>
        </div>
    </section>
    <footer class="Footer">
        <a id="footer_add" target="_blank" href="http://www.bol.com"><img src="img/bol.jpg" alt="advertentie"></a>
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script async src="js/flexi_dating.min.js"></script>
    <script src ="js/kleurenHaren.json" type="text/javascript"></script>
    <script src ="js/kleurenOgen.json" type="text/javascript"></script>
    <script type="text/javascript" src="js/fn_lib.js"></script>
    <script type="text/javascript">
            window.onload = function () {
                var sUserId = localStorage.userId;
                var sUserProfile = scrumlib.getProfileById(sUserId);
            
                var eWeergavenaam = document.getElementById("weergaveNaam");
                eWeergavenaam.innerHTML = sUserProfile[0].nickname;
                
                vulSelectIn("haarkleur",jsonKleurenHaren);
                vulSelectIn("oogkleur",jsonKleurenOgen);
                
                var eEmail = document.getElementById("email");
                eEmail.value = sUserProfile[0].email;
                var eWachtwoord = document.getElementById("wachtwoord");
                eWachtwoord.value = sUserProfile[0].wachtwoord;
                var eFamilienaam = document.getElementById("familienaam");
                eFamilienaam.value = sUserProfile[0].familienaam;
                var eVoornaam = document.getElementById("voornaam");
                eVoornaam.value = sUserProfile[0].voornaam;
                var eGeboortedatum = document.getElementById("geboortedatum");
                eGeboortedatum.value = sUserProfile[0].geboortedatum;
                var eFoto = document.getElementById("foto");
                eFoto.value = sUserProfile[0].foto;
                var eNickname = document.getElementById("nickname");
                eNickname.value = sUserProfile[0].nickname;
                
                var eHaarkleur = document.getElementById("haarkleur");
                eHaarkleur.value = sUserProfile[0].haarkleur;
                var eOogkleur = document.getElementById("oogkleur");
                eOogkleur.value = sUserProfile[0].oogkleur;
                var eGewicht = document.getElementById("gewicht");
                eGewicht.value = sUserProfile[0].gewicht;
                var eGrootte = document.getElementById("grootte");
                eGrootte.value = sUserProfile[0].grootte;
                var eBeroep = document.getElementById("beroep");
                eBeroep.value = sUserProfile[0].beroep;
                
                var geslachtWaarde = sUserProfile[0].sexe;
                radioButton("sexe", geslachtWaarde);
                var geaardheidWaarde = sUserProfile[0].seksvoorkeur;
                radioButton("seksvoorkeur", geaardheidWaarde);
                
                scrumlib.init();
                var aProfielen = scrumlib.getAllProfiles();
                var eSubmit = document.getElementById("bewaren");
                eSubmit.addEventListener("click",function(){
                var foutmelding = maakFoutMelding(aProfielen);
                if (foutmelding===""){
                    var fotoNaam = checkFoto(document.getElementById("foto").value, radioButton("sexe"));
                    var oProfiel = {
                        "familienaam" : document.getElementById("familienaam").value,
                        "voornaam" : document.getElementById("voornaam").value,
                        "geboortedatum" : document.getElementById("geboortedatum").value,
                        "email" : document.getElementById("email").value,
                        "nickname" : document.getElementById("nickname").value,
                        "beroep" : document.getElementById("beroep").value,
                        "wachtwoord" : document.getElementById("wachtwoord").value,
                        "sexe" : radioButton("sexe"),
                        "seksvoorkeur" : radioButton("seksvoorkeur"),
                        "haarkleur" : document.getElementById("haarkleur").value,
                        "oogkleur" : document.getElementById("oogkleur").value,
                        "gewicht" : document.getElementById("gewicht").value,
                        "grootte" : document.getElementById("grootte").value,
                        "foto" : fotoNaam
                    }; 
                    scrumlib.updateProfile(sUserId,oProfiel);
                    scrumlib.save();
                    location.href = "core.html";
                }
                else {
                    alert(foutmelding);
                }
                console.log(scrumlib.getAllProfiles());
                });
            }; 

            function vulSelectIn(selectID,jsonID){
                var aKleuren = JSON.parse(jsonID);
                var eSelectKleuren = document.getElementById(selectID);
                for (var i = 0; i < aKleuren.length; i++) {
                    var eOption = document.createElement('option');
                    eOption.innerHTML = aKleuren[i];
                    eOption.value = aKleuren[i];
                    eSelectKleuren.appendChild(eOption);
                };
            };

            function radioButton(el, waarde){
                var eName = document.getElementsByName(el);
                
                for (var i = 0; i<eName.length; i++) {
                    if (eName[i].value == waarde) {
                        eName[i].checked = true;
                    };
                };
            }; 

            function maakFoutMelding(aProfielen) {
                var foutmelding = "";
                var eInputs = document.getElementsByClassName("fieldRequired");
                for (var i = 0; i<eInputs.length; i++){
                    if (eInputs[i].value == ""){
                        foutmelding = "Niet alle verplichte velden werden ingevuld.";
                    }
                };
                var sGeboortedatum = document.getElementById("geboortedatum").value;
                if (berekenLeeftijd(sGeboortedatum)<16){
                    foutmelding = "U moet ouder zijn dan 16 jaar.";
                }
                var sEmail = document.getElementById("email").value;
                for (var i = 0; i < aProfielen.length; i++){
                    if (sEmail == aProfielen[i].email){
                        foutmelding = "Er bestaat al een account met dit emailadres."; 
                    }
                }
//                var sSexe = radioButton("sexe");
//                if (sSexe == null){
//                    foutmelding = "U moet uw geslacht nog invullen.";
//                }
//                var sSeksvoorkeur = radioButton("seksvoorkeur")
//                if (sSeksvoorkeur == null){
//                    foutmelding = "U moet uw geaardheid nog invullen.";
//                }
                return foutmelding;
            };

            function berekenLeeftijd(sGeboortedatum){
                var aGeboortedatum = sGeboortedatum.split("-");
                var dGeboortedatum = new Date(aGeboortedatum[0],aGeboortedatum[1]-1,aGeboortedatum[2]);
                var leeftijdMs = Date.now() - dGeboortedatum.getTime();
                var leeftijdDate = new Date(leeftijdMs);
                var leeftijd = Math.abs(leeftijdDate.getUTCFullYear()-1970);
                return leeftijd;
            }
            
            function checkFoto(naamFoto, geslacht){
                if (naamFoto != ""){
                    return naamFoto;
                }
                
                else{
                    if (geslacht == "m"){
                        return "male.png"
                    }
                    
                    else{
                        return "female.png"
                    }
                }
            }
        </script>
    </body>
</html>